From 3df26c2066110e1633f50d1695b72895d577b522 Mon Sep 17 00:00:00 2001
From: padavanonly <83120842+padavanonly@users.noreply.github.com>
Date: Sun, 10 Dec 2023 12:20:35 +0800
Subject: [PATCH 07/10] Mediatek:Set ipv6 dscp value to 0 when enable hqos dscp
 tag

---
 .../mtk/applications/luci-app-eqos-mtk/root/usr/sbin/eqos   | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/package/mtk/applications/luci-app-eqos-mtk/root/usr/sbin/eqos b/package/mtk/applications/luci-app-eqos-mtk/root/usr/sbin/eqos
index b0c9c92a1d..e4a87f1ce1 100755
--- a/package/mtk/applications/luci-app-eqos-mtk/root/usr/sbin/eqos
+++ b/package/mtk/applications/luci-app-eqos-mtk/root/usr/sbin/eqos
@@ -34,6 +34,8 @@ case "$1" in
 		sed -i '/\/etc\/init.d\/eqos start/d' /etc/firewall.user
 		iptables -t mangle -D FORWARD -i br-lan -j DSCP --set-dscp 0
 		iptables -t mangle -D FORWARD -o br-lan -j DSCP --set-dscp 0
+		ip6tables -t mangle -D FORWARD -i br-lan -j DSCP --set-dscp 0
+		ip6tables -t mangle -D FORWARD -o br-lan -j DSCP --set-dscp 0
 		echo "10 0" > /sys/kernel/debug/hnat/hnat_setting
 		for i in $(seq 0 7); do
 		echo 0 0 0 0 0 0 0 > $hqos_path/qdma_txq$i
@@ -44,6 +46,10 @@ case "$1" in
 	;;
 	"start")
 		stop_qos
+		ip6tables -t mangle -D FORWARD -i br-lan -j DSCP --set-dscp 0
+		ip6tables -t mangle -D FORWARD -o br-lan -j DSCP --set-dscp 0
+		ip6tables -t mangle -A FORWARD -i br-lan -j DSCP --set-dscp 0
+		ip6tables -t mangle -A FORWARD -o br-lan -j DSCP --set-dscp 0
 		iptables -t mangle -D FORWARD -i br-lan -j DSCP --set-dscp 0
 		iptables -t mangle -D FORWARD -o br-lan -j DSCP --set-dscp 0
 		iptables -t mangle -A FORWARD -i br-lan -j DSCP --set-dscp 0
-- 
2.43.0

